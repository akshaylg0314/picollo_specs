# PICCOLO (PULLPIRI) 컴포넌트 구현 계획

**문서 정보:**
- 문서 ID: PICCOLO-COMP-IMPL-PLAN-2025
- 버전: 1.0
- 날짜: 2025-07-28
- 분류: 컴포넌트 구현 계획서

## 개요

이 문서는 PICCOLO(PULLPIRI) 프로젝트의 각 컴포넌트별 세부 구현 계획을 정의합니다. 각 컴포넌트의 현재 구현 상태를 기반으로 필요한 작업과 우선순위를 설정합니다.

## 핵심 컴포넌트 구현 계획

### 1. APIServer

**현재 상태**: 기본 구조 구현, YAML 파싱 기능 일부 구현

**필요 작업**:
1. REST API 엔드포인트 완성
   - 모든 리소스 타입(Scenario, Package, Model, Volume, Network)에 대한 CRUD 작업 지원
   - 검색 및 필터링 기능 강화
   - 페이지네이션 및 버전 관리 지원

2. 보안 기능 구현
   - 인증 및 권한 부여 시스템 구현
   - API 키 관리
   - SSL/TLS 적용
   - 요청 속도 제한

3. Artifact 처리 파이프라인 강화
   - 검증 로직 강화
   - 비동기 처리 메커니즘 구현
   - YAML 스키마 검증 확장

4. 알림 시스템 구현
   - gRPC 스트림을 통한 실시간 알림
   - 웹훅 지원
   - 알림 필터링 및 구독 메커니즘

5. NodeAgent와의 통합
   - NodeAgent gRPC 클라이언트 구현
   - 구성 파일 및 설정 전달 메커니즘 구현

**우선순위**:
- 높음: REST API 완성, 기본 보안 기능, Artifact 검증
- 중간: 알림 시스템, 비동기 처리, NodeAgent 통합
- 낮음: 고급 보안 기능

### 2. ActionController

**현재 상태**: 기초적인 런타임 어댑터 패턴 구현

**필요 작업**:
1. 컨테이너 런타임 어댑터 완성
   - Podman 어댑터 완성
   - Docker 어댑터 구현
   - Containerd 어댑터 구현
   - Bluechi 어댑터 구현
   - 공통 인터페이스 표준화

2. 컨테이너 라이프사이클 관리 구현
   - 생성, 시작, 중지, 재시작, 제거 작업 구현
   - 상태 모니터링 및 이벤트 처리
   - 그레이스풀 종료 및 타임아웃 처리

3. 리소스 관리 기능 구현
   - CPU, 메모리, 디스크 제한 설정
   - cgroups 통합
   - 리소스 사용량 모니터링

4. 네트워크 및 볼륨 구성 자동화
   - 네트워크 인터페이스 구성
   - 볼륨 마운트 및 관리
   - 포트 매핑 및 노출

5. Bluechi 통합 및 관리 구현
   - Bluechi 서비스 관리 (시작, 중지, 재시작)
   - Bluechi 서비스 상태 모니터링
   - 노드 간 Bluechi 통신 관리
   - 서비스 의존성 정의 및 관리

6. TIMPANI 스케줄러 통합
   - CPU 코어 격리 설정
   - 실시간 우선순위 적용
   - 타이밍 제약 조건 설정

**우선순위**:
- 높음: Podman 어댑터 완성, 기본 라이프사이클 관리, Bluechi 어댑터 구현
- 중간: 리소스 관리, Docker 어댑터, Bluechi 통합 및 관리
- 낮음: Containerd 어댑터, TIMPANI 통합

### 3. StateManager

**현재 상태**: 기본 상태 저장 및 조회 기능 구현

**필요 작업**:
1. 상태 전이 메커니즘 구현
   - 상태 머신 구현
   - 상태 변경 이벤트 처리
   - 상태 전이 검증

2. 분산 상태 관리 강화
   - ETCD 감시 기능 활용
   - 락 메커니즘 구현
   - 일관성 유지 전략

3. 상태 백업 및 복구 기능
   - 상태 스냅샷 생성
   - 백업 스케줄링
   - 복구 프로세스 구현

4. 상태 쿼리 및 분석 기능
   - 고급 쿼리 인터페이스
   - 상태 이력 추적
   - 분석 API 제공

5. 오류 복구 전략 구현
   - 장애 감지
   - 자동 복구 정책
   - 롤백 메커니즘

**우선순위**:
- 높음: 상태 전이 메커니즘, 기본 분산 상태 관리
- 중간: 상태 쿼리 기능, 오류 복구
- 낮음: 백업 및 복구, 고급 분석 기능

### 4. FilterGateway

**현재 상태**: 초기 설계 단계

**필요 작업**:
1. 시나리오 처리 로직 구현
   - 조건 평가 엔진
   - 시나리오 활성화/비활성화 메커니즘
   - 상태 기반 평가

2. 필터링 메커니즘 구현
   - 요청 검증 및 필터링
   - 우선순위 기반 처리
   - 정책 적용

3. PolicyManager 통합
   - 정책 조회 및 적용
   - 결정 위임
   - 결과 처리

4. ActionController 통합
   - 액션 요청 변환
   - 결과 처리 및 상태 업데이트

5. 고성능 처리 최적화
   - 병렬 처리
   - 메모리 사용 최적화
   - 처리 지연 최소화

**우선순위**:
- 높음: 기본 시나리오 처리, ActionController 통합
- 중간: 필터링 메커니즘, PolicyManager 통합
- 낮음: 고성능 처리 최적화

## 확장 컴포넌트 구현 계획

### 1. PolicyManager

**현재 상태**: 초기 설계 단계

**필요 작업**:
1. 정책 정의 및 관리 인터페이스
   - 정책 CRUD 작업
   - 정책 버전 관리
   - 템플릿 지원

2. 정책 평가 엔진
   - 규칙 기반 평가
   - 우선순위 처리
   - 충돌 해결

3. 보안 정책 구현
   - 접근 제어
   - 권한 검증
   - 보안 제약 조건

4. 자원 정책 구현
   - 리소스 할당 정책
   - 사용량 제한
   - 공정성 보장

5. 정책 모니터링 및 감사
   - 정책 적용 이력
   - 결정 로깅
   - 감사 보고서

**우선순위**:
- 높음: 기본 정책 정의 인터페이스, 정책 평가 엔진
- 중간: 자원 정책, 정책 모니터링
- 낮음: 고급 보안 정책, 감사 기능

### 2. MonitoringServer

**현재 상태**: 초기 설계 단계

**필요 작업**:
1. 메트릭 수집 시스템
   - 노드 및 컨테이너 메트릭 수집
   - 시스템 메트릭 수집
   - 사용자 정의 메트릭 지원

2. 로그 집계 및 처리
   - 로그 수집 파이프라인
   - 로그 파싱 및 구조화
   - 로그 저장 및 압축

3. 알림 시스템
   - 임계값 기반 알림
   - 이상 감지
   - 알림 라우팅 및 에스컬레이션

4. 시각화 및 대시보드
   - 메트릭 시각화 API
   - 대시보드 템플릿
   - 사용자 정의 뷰

5. 분석 및 보고
   - 추세 분석
   - 상관 관계 분석
   - 보고서 생성

**우선순위**:
- 높음: 기본 메트릭 수집, 로그 집계
- 중간: 알림 시스템, 기본 시각화
- 낮음: 고급 분석, 보고 기능

### 3. NodeAgent

**현재 상태**: 초기 설계 단계

**필요 작업**:
1. 노드 상태 모니터링
   - 하드웨어 상태 모니터링
   - OS 메트릭 수집
   - 연결 상태 관리

2. 컨테이너 관리
   - 로컬 컨테이너 상태 모니터링
   - 컨테이너 이벤트 처리
   - 로컬 로그 수집

3. 로컬 리소스 관리
   - 디스크 공간 관리
   - 임시 파일 정리
   - 캐시 관리

4. 설정 및 파일 배포
   - 안전한 파일 배포
   - 설정 적용
   - 변경 검증

5. Bluechi 환경 구성
   - Bluechi 구성 파일 생성 및 배포
   - Bluechi 필요 디렉토리 및 권한 설정
   - 기본 환경 설정 적용
   
6. 오류 처리 및 복구
   - 로컬 오류 감지 및 처리
   - 자동 복구 작업
   - 오류 보고

**우선순위**:
- 높음: 기본 노드 상태 모니터링, 컨테이너 관리, 설정 및 파일 배포
- 중간: 로컬 리소스 관리, Bluechi 환경 구성
- 낮음: 고급 오류 처리 및 복구

## 특화 컴포넌트 구현 계획

### 1. TIMPANI Scheduler

**현재 상태**: 개념 설계 단계

**필요 작업**:
1. 결정적 스케줄링 구현
   - 실시간 스케줄러 통합
   - 태스크 우선순위 지정
   - 스케줄 가능성 분석

2. CPU 코어 격리 및 관리
   - CPU 세트 구성
   - 코어 예약 및 할당
   - 격리 보장 메커니즘

3. 시간 제약 조건 관리
   - 데드라인 설정 및 모니터링
   - 타이밍 위반 감지
   - 실행 시간 예측

4. 부하 관리 및 조정
   - 로드 밸런싱
   - CPU 사용률 안정화
   - 적응형 스케줄링

5. 모니터링 및 분석
   - 성능 지표 수집
   - 타이밍 분석
   - 병목 현상 감지

**우선순위**:
- 높음: 기본 실시간 스케줄링, CPU 코어 격리
- 중간: 시간 제약 조건 관리, 기본 모니터링
- 낮음: 고급 부하 관리, 상세 성능 분석

### 2. PHAROS Networking

**현재 상태**: 개념 설계 단계

**필요 작업**:
1. eBPF 프로그램 개발
   - 패킷 처리 프로그램
   - XDP 프로그램
   - 트래픽 제어 프로그램

2. 네트워크 오케스트레이션
   - 컨테이너 네트워크 구성
   - 가상 네트워크 관리
   - IP 할당 및 관리

3. 패킷 필터링 및 라우팅
   - 필터 규칙 관리
   - NAT 및 포워딩 구현
   - 방화벽 기능

4. QoS 구현
   - 트래픽 우선순위 지정
   - 대역폭 제한 및 보장
   - 지연 제어

5. 보안 및 격리
   - 네트워크 격리 구현
   - 보안 그룹 관리
   - 침입 탐지 기능

**우선순위**:
- 높음: 기본 eBPF 프로그램, 컨테이너 네트워크 구성
- 중간: 패킷 필터링, 기본 QoS
- 낮음: 고급 보안 기능, 침입 탐지

### 3. SettingsService

**현재 상태**: 초기 설계 단계

**필요 작업**:
1. 설정 관리 백엔드
   - 설정 CRUD 작업
   - 설정 검증
   - 버전 관리

2. UI 인터페이스
   - 웹 기반 관리 콘솔
   - 인터랙티브 설정 편집기
   - 설정 탐색기

3. CLI 인터페이스
   - 명령줄 도구
   - 스크립팅 지원
   - 배치 작업

4. 변경 검증 및 적용
   - 변경 사전 검증
   - 롤아웃 전략
   - 롤백 메커니즘

5. 사용자 관리
   - 사용자 계정 관리
   - 역할 및 권한
   - 액세스 로그

**우선순위**:
- 높음: 설정 관리 백엔드, 기본 CLI
- 중간: 변경 검증, 기본 UI
- 낮음: 고급 사용자 관리, 고급 웹 콘솔

## 공통 라이브러리 및 유틸리티

### 1. ETCD 클라이언트 라이브러리

**현재 상태**: 기본 구현 완료, 최적화 필요

**필요 작업**:
1. 고급 쿼리 기능 확장
   - 범위 쿼리 최적화
   - 필터 및 정렬 지원
   - 대용량 결과 처리

2. 트랜잭션 기능 강화
   - 원자적 작업 지원
   - 조건부 작업 확장
   - 트랜잭션 로깅

3. 감시 메커니즘 개선
   - 효율적인 이벤트 처리
   - 필터링 옵션 확장
   - 재연결 및 복구 로직

4. 성능 최적화
   - 연결 풀링
   - 캐싱 전략
   - 직렬화 최적화

5. 장애 복구 강화
   - 재시도 전략
   - 클러스터 인식
   - 장애 감지 및 대응

**우선순위**:
- 높음: 감시 메커니즘 개선, 기본 성능 최적화
- 중간: 트랜잭션 기능 강화, 장애 복구
- 낮음: 고급 쿼리 기능, 고급 캐싱

### 2. 로깅 및 모니터링 프레임워크

**현재 상태**: 기본 로깅 구현

**필요 작업**:
1. 구조화된 로깅 시스템
   - JSON 형식 로깅
   - 컨텍스트 정보 추가
   - 로그 레벨 관리

2. 메트릭 수집 프레임워크
   - 카운터, 게이지, 히스토그램
   - 레이블 지원
   - 메트릭 집계

3. 추적 시스템
   - 분산 추적
   - 스팬 및 컨텍스트 관리
   - 성능 측정

4. 알림 프레임워크
   - 알림 정의 및 관리
   - 통지 채널
   - 알림 상태 관리

5. 시각화 라이브러리
   - 데이터 포맷팅
   - 차트 및 그래프 생성
   - 인터랙티브 대시보드 지원

**우선순위**:
- 높음: 구조화된 로깅, 기본 메트릭 수집
- 중간: 알림 프레임워크, 기본 추적
- 낮음: 고급 시각화, 분산 추적

## 결론

이 컴포넌트 구현 계획은 PICCOLO(PULLPIRI) 프로젝트의 개발 로드맵을 지원하기 위한 상세 작업 목록을 제공합니다. 각 컴포넌트별로 우선순위가 설정되어 있으며, 개발 팀은 이를 기반으로 세부 작업을 계획하고 할당할 수 있습니다. 프로젝트 진행에 따라 이 계획은 정기적으로 검토 및 업데이트되어야 합니다.
