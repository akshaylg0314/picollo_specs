# PICCOLO 시스템 아키텍처 및 기능 개요

**문서 정보:**
- 문서 ID: PICCOLO-ARCH-OVERVIEW-2025
- 버전: 1.0
- 날짜: 2025-07-28
- 분류: 시스템 아키텍처 개요

## 목차

1. [개요](#1-개요)
2. [시스템 아키텍처](#2-시스템-아키텍처)
3. [컴포넌트 설명](#3-컴포넌트-설명)
4. [기능 경계](#4-기능-경계)
5. [데이터 흐름](#5-데이터-흐름)
6. [통합 시나리오](#6-통합-시나리오)

## 1. 개요

PICCOLO는 차량 환경에 최적화된 OS 독립적 컨테이너 프레임워크로, SDV(Software-Defined Vehicle) 시대에 알맞은 차량용 시스템 오케스트레이터입니다. 본 문서는 PICCOLO의 전체 시스템 아키텍처와 차량-클라우드 간 연동 구조를 설명합니다.

### 1.1 주요 특징

- **선언적 리소스 관리**: YAML 기반 리소스 정의 및 관리
- **차량 상태 기반 시나리오**: 차량 상태에 따른 동적 서비스 관리
- **컨테이너 라이프사이클 관리**: Podman 기반 컨테이너 관리
- **실시간 제어 및 네트워킹**: TIMPANI 스케줄링과 PHAROS 네트워킹
- **클라우드 연동 CI/CD**: 통합 개발 및 배포 플랫폼
- **정책 기반 리소스 관리**: 안전성과 성능 최적화

## 2. 시스템 아키텍처

PICCOLO 시스템은 차량 내부 컴포넌트와 클라우드 컴포넌트로 구성되며, 안전하고 효율적인 데이터 교환과 서비스 관리를 제공합니다.


## 3. 컴포넌트 설명

### 3.1 차량 내 컴포넌트

#### 핵심 컴포넌트
- **API Server**: 외부 API를 제공하며 아티팩트 등록 및 관리
- **Filter Gateway**: 시나리오 처리 및 정책 기반 필터링
- **Action Controller**: 컨테이너 라이프사이클 관리 및 실행
- **State Manager**: 시스템 상태 관리 및 동기화
- **Monitoring Server**: 모니터링 데이터 수집 및 분석
- **Policy Manager**: 정책 기반 서비스 우선순위 결정
- **Settings Service**: 설정 관리 및 상태 동기화

#### 저장소
- **ETCD**: 분산 키-값 저장소, 시스템 상태 및 설정 저장

#### 실행 환경
- **TIMPANI Scheduler**: 결정적 실시간 스케줄링과 CPU 격리
- **Node Agent**: 노드 상태 모니터링 및 컨테이너 관리

#### 특화 모듈
- **Device Manager**: 하드웨어 장치 접근 및 관리
- **Audio Manager**: 오디오 리소스 및 스트림 관리
- **Window Manager**: 디스플레이 및 윈도우 관리
- **Storage Manager**: 저장소 할당 및 볼륨 관리
- **Node Manager**: 노드 연결 및 상태 관리

#### 네트워킹
- **PHAROS Networking**: eBPF 기반 고성능 네트워크 오케스트레이션
- **Network Manager**: 네트워크 자원 및 연결 관리
- **Cloud Manager**: 클라우드 연결 및 통합 관리

### 3.2 클라우드 컴포넌트

#### 개발 및 배포
- **개발자 포털**: 개발 환경, 도구, 시뮬레이션 제공
- **CI/CD 파이프라인**: 빌드, 테스트, 패키징 자동화
- **아티팩트 저장소**: 배포 가능한 아티팩트 및 패키지 저장

#### 클라우드 핵심 서비스
- **OTA 서비스**: 원격 소프트웨어 업데이트 관리
- **원격 관리**: 차량 원격 구성 및 제어
- **데이터 분석 플랫폼**: 차량 데이터 분석 및 인사이트 도출

#### 차량 관리
- **차량 관리 시스템**: 차량군 모니터링 및 관리
- **원격 진단**: 원격 차량 진단 및 문제 해결

## 4. 기능 경계

PICCOLO 시스템의 기능 경계는 다음과 같이 정의됩니다:

### 4.1 차량 내 영역
- 컨테이너 라이프사이클 관리 및 오케스트레이션
- 실시간 스케줄링 및 리소스 할당
- 차량 상태 기반 서비스 관리
- 로컬 모니터링 및 상태 관리
- 차량 내 네트워크 오케스트레이션

### 4.2 클라우드 영역
- CI/CD 및 개발 환경 제공
- OTA 업데이트 관리 및 배포
- 차량군 데이터 수집 및 분석
- 원격 모니터링 및 관리
- 서비스 및 정책 정의

### 4.3 연결 영역
- 안전한 차량-클라우드 통신
- 데이터 동기화 및 교환
- 원격 진단 및 관리

## 5. 데이터 흐름

PICCOLO 시스템의 주요 데이터 흐름은 다음과 같습니다:

1. **애플리케이션 개발 및 배포 흐름**:
   - 개발자 포털에서 서비스 설계 및 개발
   - CI/CD 파이프라인을 통한 빌드, 테스트, YAML 생성
   - 아티팩트 저장소에 패키지 등록 및 관리
   - OTA 서비스를 통한 차량 API Server로 아티팩트 전송
   - API Server의 아티팩트 검증 및 ETCD 등록
   - Filter Gateway의 시나리오 기반 처리
   - Policy Manager의 정책 검사
   - Action Controller의 컨테이너 생성 및 런타임 관리
   - TIMPANI Scheduler를 통한 실시간 스케줄링 적용

2. **모니터링 및 텔레메트리 흐름**:
   - Node Agent의 컨테이너 및 노드 수준 메트릭 수집
   - Monitoring Server의 시스템 전체 메트릭 집계 및 분석
   - Cloud Manager를 통한 클라우드 분석 플랫폼으로 데이터 전송
   - 분석 플랫폼의 데이터 처리 및 인사이트 도출
   - 차량 관리 시스템을 통한 원격 모니터링 및 관리

3. **상태 및 설정 관리 흐름**:
   - ETCD를 중심으로 한 상태 정보 저장 및 동기화
   - Node Agent의 컨테이너 상태 변화 감지 및 State Manager 알림
   - State Manager의 중앙 상태 관리 및 상태 전이 제어
   - Settings Service와 State Manager 간 설정 동기화
   - Policy Manager의 정책 적용 및 Filter Gateway 제어
   - Cloud Manager를 통한 원격 구성 변경 수신 및 적용

4. **네트워킹 및 통신 흐름**:
   - PHAROS Networking의 eBPF 기반 패킷 처리
   - Network Manager의 네트워크 리소스 할당 및 관리
   - Cloud Manager와 클라우드 서비스 간 안전한 데이터 교환
   - 특화 관리자와 Filter Gateway 간 리소스 요청 및 할당

## 6. 통합 시나리오

### 6.1 애플리케이션 개발 및 배포 시나리오

1. 개발자가 개발자 포털을 통해 차량용 애플리케이션 개발
2. CI/CD 파이프라인에서 코드 빌드, 테스트, 컨테이너화, YAML 명세 생성
3. 아티팩트 저장소에 컨테이너 이미지 및 YAML 명세 저장
4. 클라우드 OTA 서비스가 업데이트 패키지 준비 및 차량 배포 예약
5. Cloud Manager가 OTA 서비스로부터 업데이트 알림 수신
6. API Server가 아티팩트 다운로드, 검증 및 ETCD 등록
7. Filter Gateway가 Policy Manager의 정책에 따라 배포 검증 및 처리
8. Action Controller가 컨테이너 이미지 준비 및 실행 환경 구성
9. TIMPANI Scheduler가 CPU 코어 할당 및 실시간 스케줄링 구성
10. Node Agent가 컨테이너 실행 및 상태 모니터링 시작
11. State Manager가 시스템 상태 업데이트 및 동기화
12. Monitoring Server가 새 서비스 모니터링 지표 수집 시작

### 6.2 차량 상태 기반 동적 서비스 관리 시나리오

1. 차량 센서로부터 주행 시작 상태 감지 (예: 기어 변경, 속도 증가)
2. 해당 상태 이벤트가 Filter Gateway에 전달
3. Filter Gateway가 관련 시나리오 조건 확인 및 활성화
4. Policy Manager가 주행 모드에 맞는 우선순위 정책 적용
5. State Manager가 시스템 상태 변경 및 전체 컴포넌트에 전파
6. Filter Gateway가 주행 안전 관련 서비스 활성화 요청
7. Action Controller가 우선순위 높은 안전 서비스 시작, 비필수 서비스 중지
8. TIMPANI Scheduler가 안전 중요 프로세스에 더 많은 CPU 자원 할당
9. PHAROS Networking이 네트워크 트래픽 우선순위 조정
10. 특화 관리자들(Audio, Device, Window)이 주행 모드에 맞게 리소스 재할당
11. Monitoring Server가 변경된 서비스 상태 및 리소스 사용 모니터링
12. Cloud Manager가 중요 상태 변화를 클라우드 플랫폼에 보고

### 6.3 클라우드 연동 진단 및 문제 해결 시나리오

1. Monitoring Server가 특정 서비스의 비정상 동작 감지
2. State Manager에 이상 상태 보고 및 로그 수집
3. Cloud Manager를 통해 원격 진단 서비스에 문제 보고
4. 원격 진단 서비스가 추가 진단 데이터 요청
5. API Server가 진단 명령 수신 및 Filter Gateway에 전달
6. 해당 서비스에 대한 상세 진단 데이터 수집
7. 원격 진단 서비스가 문제 분석 및 해결책 제시
8. OTA 서비스가 필요시 패치 또는 업데이트 전송
9. Policy Manager가 안전한 업데이트 적용 조건 검증
10. 시스템이 패치 적용 또는 대체 서비스 활성화
