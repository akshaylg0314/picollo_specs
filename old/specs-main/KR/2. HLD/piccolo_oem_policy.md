# PICCOLO PolicyManager 상세 설계 문서

**문서 번호**: PICCOLO-POLICY-2025-001  
**버전**: 1.1  
**날짜**: 2025-07-16  
**작성자**: joshua-jung_LGESDV  
**분류**: 설계 명세서

## 1. 개요

본 문서는 PICCOLO 프레임워크의 PolicyManager에 대한 상세 설계를 기술합니다. PolicyManager는 차량 상태, 안전 등급, 리소스 사용, 자율주행 레벨에 따라 서비스의 우선순위를 결정하고 이를 기반으로 서비스의 실행 허용(allow), 대기(pending), 거부(deny) 여부를 판단합니다.

## 2. 설계 목표

PolicyManager는 다음과 같은 목표를 가지고 설계되었습니다:

1. 우선순위가 높은 서비스가 우선적으로 허용되도록 함
2. 차량 상태에 따라 서비스의 우선순위를 동적으로 조정
3. 안전 등급(ASIL)에 따라 서비스의 우선순위를 차등화
4. 리소스 충돌 발생 시 상황에 맞는 deny/pending 결정
5. 자율주행 레벨에 따른 서비스 우선순위 조정

## 3. 우선순위 결정 요소

### 3.1 기본 서비스 우선순위

서비스 타입별 기본 우선순위를 1-100 범위로 정의합니다(높을수록 우선순위 높음).

| 서비스 유형 | 기본 우선순위 | 설명 |
|------------|--------------|------|
| safety-critical | 90 | 안전 필수 서비스 (브레이크 제어, 조향 제어) |
| adas | 85 | 운전자 지원 시스템 |
| hud | 80 | 헤드업 디스플레이 |
| navigation | 75 | 내비게이션 |
| cluster | 70 | 계기판 |
| alert | 65 | 경고 및 알림 |
| voice-control | 60 | 음성 제어 |
| diagnostics | 55 | 차량 진단 |
| media | 50 | 미디어 (오디오/비디오) |
| comfort | 45 | 편의 기능 (온도 조절, 시트 조절) |
| infotainment | 40 | 인포테인먼트 |
| connectivity | 35 | 연결성 서비스 |
| background | 30 | 백그라운드 서비스 |
| update | 25 | 소프트웨어 업데이트 |

### 3.2 차량 상태별 우선순위 조정

차량 상태에 따른 서비스 유형별 우선순위 조정값을 정의합니다.

#### 3.2.1 전원 꺼짐 상태 (poweroff)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | -50 |
| adas | -90 |
| hud | -90 |
| navigation | -90 |
| cluster | -90 |
| alert | -50 |
| voice-control | -90 |
| diagnostics | +10 |
| media | -90 |
| comfort | -90 |
| infotainment | -90 |
| connectivity | -50 |
| background | +10 |
| update | +20 |

#### 3.2.2 시동 상태 (ignition)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | +10 |
| adas | +5 |
| hud | +5 |
| navigation | 0 |
| cluster | +10 |
| alert | +10 |
| voice-control | -10 |
| diagnostics | +15 |
| media | -20 |
| comfort | 0 |
| infotainment | -20 |
| connectivity | +5 |
| background | +5 |
| update | -10 |

#### 3.2.3 주차 상태 (parking)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | 0 |
| adas | -10 |
| hud | -20 |
| navigation | +5 |
| cluster | -5 |
| alert | +5 |
| voice-control | +10 |
| diagnostics | +15 |
| media | +15 |
| comfort | +10 |
| infotainment | +15 |
| connectivity | +10 |
| background | +5 |
| update | +20 |

#### 3.2.4 주행 상태 (driving)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | +10 |
| adas | +15 |
| hud | +15 |
| navigation | +15 |
| cluster | +10 |
| alert | +10 |
| voice-control | +5 |
| diagnostics | -20 |
| media | -5 |
| comfort | 0 |
| infotainment | -10 |
| connectivity | -5 |
| background | -20 |
| update | -80 |

#### 3.2.5 중립 상태 (neutral)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | +5 |
| adas | +10 |
| hud | +10 |
| navigation | +10 |
| cluster | +5 |
| alert | +5 |
| voice-control | +5 |
| diagnostics | 0 |
| media | +5 |
| comfort | +5 |
| infotainment | +5 |
| connectivity | +5 |
| background | 0 |
| update | -10 |

#### 3.2.6 후진 상태 (reverse)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | +10 |
| adas | +15 |
| hud | +5 |
| navigation | -5 |
| cluster | +5 |
| alert | +10 |
| voice-control | -5 |
| diagnostics | -10 |
| media | -15 |
| comfort | -5 |
| infotainment | -15 |
| connectivity | -10 |
| background | -15 |
| update | -80 |

### 3.3 ASIL 안전 등급별 우선순위 조정

| ASIL 등급 | 우선순위 조정 | 설명 |
|----------|--------------|------|
| QM | 0 | 품질 관리 (Quality Managed) |
| A | +5 | ASIL A |
| B | +10 | ASIL B |
| C | +15 | ASIL C |
| D | +20 | ASIL D (최고 안전 등급) |

### 3.4 디바이스 충돌 정책

리소스 충돌 시 서비스의 deny/pending 여부를 결정하는 정책입니다.

| 디바이스 | 충돌 시 정책 | 타임아웃(초) | 재시도 횟수 | 추가 정보 |
|---------|------------|------------|-----------|---------|
| audio | pending | 30 | 3 | |
| gpu | pending | 60 | 5 | |
| speaker | pending | 15 | 2 | |
| mic | deny | - | - | 개인정보 민감 리소스 |
| display | pending | 45 | 3 | |
| npu | pending | 120 | 10 | |

### 3.5 자율주행 레벨별 우선순위 조정

#### 3.5.1 레벨 1 (운전자 지원)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | +5 |
| adas | +10 |
| hud | +10 |
| alert | +10 |
| navigation | +5 |
| cluster | +5 |
| media | 0 |
| infotainment | -5 |
| update | -15 |

#### 3.5.2 레벨 2 (부분 자동화)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | +10 |
| adas | +15 |
| hud | +15 |
| alert | +15 |
| navigation | +10 |
| cluster | +10 |
| voice-control | +5 |
| media | -10 |
| infotainment | -15 |
| update | -25 |

#### 3.5.3 레벨 3 (조건부 자동화)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | +15 |
| adas | +20 |
| hud | +10 |
| alert | +15 |
| navigation | +5 |
| cluster | +10 |
| voice-control | +10 |
| media | +5 |
| infotainment | 0 |
| update | -30 |

#### 3.5.4 레벨 4 (고도 자동화)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | +20 |
| adas | +25 |
| hud | +5 |
| alert | +15 |
| navigation | +15 |
| voice-control | +15 |
| media | +10 |
| infotainment | +5 |
| comfort | +10 |
| update | -10 |

#### 3.5.5 레벨 5 (완전 자동화)

| 서비스 유형 | 우선순위 조정 |
|------------|--------------|
| safety-critical | +25 |
| adas | +25 |
| navigation | +20 |
| alert | +15 |
| infotainment | +15 |
| media | +15 |
| comfort | +15 |
| voice-control | +15 |
| connectivity | +10 |
| update | 0 |

## 4. 결정 로직

### 4.1 최종 우선순위 계산

최종 우선순위는 다음 요소의 합으로 계산됩니다:
```
최종 우선순위 = 기본 우선순위 + 차량 상태 조정 + ASIL 등급 조정 + 자율주행 레벨 조정
```

### 4.2 결정 임계값

| 결정 | 임계값 |
|------|--------|
| 허용 (allow) | ≥ 70 |
| 대기 (pending) | ≥ 40, < 70 |
| 거부 (deny) | < 40 |

### 4.3 특별 규칙

일부 상황에서는 계산된 우선순위와 관계없이 특별 규칙이 적용됩니다:

1. 안전 중요 서비스(safety-critical)는 주행 중(driving) 항상 허용됨
2. 소프트웨어 업데이트(update)는 주행 중(driving) 항상 거부됨
3. 자율주행 레벨 4-5에서는 운전자 주의 관련 알림의 우선순위가 감소함

## 5. 서비스 유형별 정책 예시

### 5.1 안전 중요 서비스

| 서비스 이름 패턴 | 유형 | ASIL 등급 | 필요 디바이스 |
|-----------------|------|----------|--------------|
| brake-control-* | safety-critical | D | npu |
| steering-control-* | safety-critical | D | npu |

### 5.2 ADAS 서비스

| 서비스 이름 패턴 | 유형 | ASIL 등급 | 필요 디바이스 |
|-----------------|------|----------|--------------|
| lane-assist-* | adas | B | gpu, npu |
| adaptive-cruise-* | adas | C | npu |
| collision-warning-* | adas | B | gpu, npu |

### 5.3 인포테인먼트 서비스

| 서비스 이름 패턴 | 유형 | ASIL 등급 | 필요 디바이스 |
|-----------------|------|----------|--------------|
| navigation-* | navigation | QM | display, gpu, speaker |
| media-* | media | QM | audio, display, gpu |
| infotainment-* | infotainment | QM | display, gpu, audio |

### 5.4 기타 서비스

| 서비스 이름 패턴 | 유형 | ASIL 등급 | 필요 디바이스 |
|-----------------|------|----------|--------------|
| voice-* | voice-control | QM | mic, speaker, npu |
| diagnostic-* | diagnostics | QM | npu |
| update-* | update | QM | - |

## 6. 종합 서비스 우선순위 계산 예시

### 6.1 차량 상태별 서비스 우선순위 테이블

다음은 자율주행 레벨 3, ASIL B 안전 등급에서의 다양한 차량 상태별 최종 우선순위 계산 예시입니다:

| 서비스 유형 | 기본 | Poweroff | Ignition | Parking | Driving | Neutral | Reverse |
|------------|------|----------|----------|---------|---------|---------|---------|
| safety-critical | 90 | 65 | 125 | 115 | 125 | 120 | 125 |
| adas | 85 | 25 | 120 | 105 | 130 | 125 | 130 |
| hud | 80 | 10 | 105 | 80 | 115 | 110 | 105 |
| navigation | 75 | 0 | 90 | 95 | 105 | 100 | 85 |
| cluster | 70 | 0 | 100 | 85 | 100 | 95 | 95 |
| alert | 65 | 35 | 100 | 95 | 100 | 95 | 100 |
| voice-control | 60 | 0 | 70 | 90 | 85 | 85 | 75 |
| diagnostics | 55 | 75 | 80 | 80 | 45 | 65 | 55 |
| media | 50 | 0 | 45 | 80 | 60 | 70 | 50 |
| comfort | 45 | 0 | 65 | 75 | 65 | 70 | 60 |
| infotainment | 40 | 0 | 40 | 75 | 50 | 65 | 45 |
| connectivity | 35 | 0 | 60 | 65 | 50 | 60 | 45 |
| background | 30 | 50 | 45 | 45 | 20 | 40 | 25 |
| update | 25 | 55 | 25 | 55 | 0 | 25 | 0 |

* 주: 표의 값은 기본 우선순위 + 차량 상태 조정 + ASIL B 등급 조정(+10) + 자율주행 레벨 3 조정으로 계산되었으며, 최대값은 100으로 제한됨

### 6.2 자율주행 레벨별 주요 서비스 우선순위 비교

다음은 주행(Driving) 상태에서 ASIL B 안전 등급에 대한 자율주행 레벨별 주요 서비스 우선순위 비교입니다:

| 서비스 유형 | 기본 | 레벨 1 | 레벨 2 | 레벨 3 | 레벨 4 | 레벨 5 |
|------------|------|-------|-------|-------|-------|-------|
| safety-critical | 90 | 115 | 120 | 125 | 130 | 135 |
| adas | 85 | 120 | 125 | 130 | 135 | 135 |
| hud | 80 | 115 | 120 | 115 | 110 | 105 |
| navigation | 75 | 105 | 110 | 105 | 115 | 120 |
| alert | 65 | 95 | 100 | 100 | 100 | 100 |
| media | 50 | 55 | 45 | 60 | 65 | 70 |
| infotainment | 40 | 35 | 25 | 40 | 45 | 55 |
| update | 25 | 0 | 0 | 0 | 0 | 0 |

* 주: 표의 값은 기본 우선순위 + 주행 상태 조정 + ASIL B 등급 조정(+10) + 자율주행 레벨별 조정으로 계산되었으며, 최대값은 100으로 제한됨, 최소값은 0으로 제한됨

### 6.3 구체적 서비스 사례 분석

#### 6.3.1 주행 중 차선 이탈 경고 서비스 (레벨별 변화)

| 자율주행 레벨 | 기본 | 차량 상태 | ASIL | 자율주행 | 최종 | 결정 |
|------------|------|----------|------|---------|------|------|
| 레벨 1 | 85 | +15 | +10 | +10 | 120 | 허용 |
| 레벨 2 | 85 | +15 | +10 | +15 | 125 | 허용 |
| 레벨 3 | 85 | +15 | +10 | +20 | 130 | 허용 |
| 레벨 4 | 85 | +15 | +10 | +25 | 135 | 허용 |
| 레벨 5 | 85 | +15 | +10 | +25 | 135 | 허용 |

#### 6.3.2 주행 중 미디어 플레이어 (레벨별 변화)

| 자율주행 레벨 | 기본 | 차량 상태 | ASIL | 자율주행 | 최종 | 결정 |
|------------|------|----------|------|---------|------|------|
| 레벨 1 | 50 | -5 | 0 | 0 | 45 | 대기 |
| 레벨 2 | 50 | -5 | 0 | -10 | 35 | 거부 |
| 레벨 3 | 50 | -5 | 0 | +5 | 50 | 대기 |
| 레벨 4 | 50 | -5 | 0 | +10 | 55 | 대기 |
| 레벨 5 | 50 | -5 | 0 | +15 | 60 | 대기 |

#### 6.3.3 주차 중 소프트웨어 업데이트 (상태별 변화)

| 차량 상태 | 기본 | 차량 상태 | ASIL | 자율주행 레벨 3 | 최종 | 결정 |
|---------|------|----------|------|---------------|------|------|
| Poweroff | 25 | +20 | 0 | -30 | 15 | 거부 |
| Ignition | 25 | -10 | 0 | -30 | 0 | 거부 |
| Parking | 25 | +20 | 0 | -30 | 15 | 거부 |
| Driving | 25 | -80 | 0 | -30 | 0 | 거부 |
| Neutral | 25 | -10 | 0 | -30 | 0 | 거부 |
| Reverse | 25 | -80 | 0 | -30 | 0 | 거부 |

## 7. ISO 26262 기능 안전성 통합

### 7.1 안전 목표 및 ASIL 등급 정의

PolicyManager는 ISO 26262 자동차 기능 안전 표준을 준수하기 위해 다음과 같은 안전 목표를 정의합니다:

| 안전 목표 ID | 설명 | ASIL 등급 | 적용 대상 서비스 |
|------------|------|----------|-----------------|
| SG-01 | 차량 주행 중 안전 필수 서비스의 신뢰성 있는 실행 보장 | D | safety-critical, adas |
| SG-02 | 차량 상태에 부적합한 서비스의 실행 방지 | C | 모든 서비스 |
| SG-03 | 리소스 충돌 시 안전 필수 서비스의 우선 실행 보장 | C | safety-critical, adas, alert |

### 7.2 ASIL 등급별 안전 메커니즘

각 ASIL 등급에 따라 다음과 같은 안전 메커니즘을 적용합니다:

#### 7.2.1 ASIL D 서비스 요구사항

| 범주 | 요구사항 | 구현 방법 |
|------|----------|-----------|
| 모니터링 | 50ms 간격 모니터링 | 정기적 상태 확인 및 심박 검사 |
| 결함 처리 | 최대 3회 재시도, 500ms 내 복구 | 자동 복구 메커니즘 |
| 리소스 요구사항 | CPU 격리, 메모리 예약, 중복성 | 전용 리소스 할당 |
| 최소 우선순위 | 80 이상 보장 | 우선순위 하한선 설정 |

#### 7.2.2 ASIL C 서비스 요구사항

| 범주 | 요구사항 | 구현 방법 |
|------|----------|-----------|
| 모니터링 | 100ms 간격 모니터링 | 정기적 상태 확인 |
| 결함 처리 | 최대 2회 재시도, 1000ms 내 복구 | 자동 복구 메커니즘 |
| 리소스 요구사항 | CPU 격리, 메모리 예약 | 전용 리소스 할당 |
| 최소 우선순위 | 70 이상 보장 | 우선순위 하한선 설정 |

#### 7.2.3 ASIL B 서비스 요구사항

| 범주 | 요구사항 | 구현 방법 |
|------|----------|-----------|
| 모니터링 | 200ms 간격 모니터링 | 정기적 상태 확인 |
| 결함 처리 | 최대 2회 재시도, 2000ms 내 복구 | 자동 복구 메커니즘 |
| 리소스 요구사항 | 메모리 예약 | 메모리 할당 보장 |
| 최소 우선순위 | 60 이상 보장 | 우선순위 하한선 설정 |

#### 7.2.4 ASIL A 서비스 요구사항

| 범주 | 요구사항 | 구현 방법 |
|------|----------|-----------|
| 모니터링 | 500ms 간격 모니터링 | 정기적 상태 확인 |
| 결함 처리 | 최대 1회 재시도, 3000ms 내 복구 | 제한적 복구 시도 |
| 리소스 요구사항 | 일반 리소스 사용 | 표준 리소스 관리 |
| 최소 우선순위 | 50 이상 보장 | 우선순위 하한선 설정 |

### 7.3 안전 메커니즘 구현

#### 7.3.1 서비스 모니터링

- 실행 시간 모니터링: 서비스 실행 시간이 예상 범위를 벗어나는지 감시
- 리소스 사용 모니터링: CPU, 메모리, 네트워크 사용량 추적
- 건전성 확인: 정기적 상태 확인 및 오류 감지

#### 7.3.2 결함 감지 및 대응

- 단계적 복구 메커니즘: 경미한 문제는 자동 복구, 심각한 문제는 안전 상태로 전환
- 중요도별 대응 전략:
  - 심각: 서비스 즉시 종료 및 안전 상태 활성화
  - 주요: 서비스 일시 중단 및 복구 시도
  - 경미: 로깅 및 자동 복구 시도

#### 7.3.3 안전한 상태 전환

- 단계적 성능 저하 정의:
  - 최소 기능: 핵심 안전 기능만 유지
  - 필수 기능: 안전 및 기본 작동에 필요한 기능 유지
  - 정상 기능: 모든 기능 활성화
- 상태 전환 조건 및 시간 제약:
  - 안전 중요 서비스: 1000ms 내 완료
  - 일반 서비스: 5000ms 내 완료

### 7.4 검증 및 확인 요구사항

#### 7.4.1 테스트 요구사항

- 코드 커버리지: ASIL D 서비스는 100% 분기 커버리지 및 MC/DC 커버리지 필요
- 요구사항 추적성: 모든 안전 요구사항은 테스트 케이스와 연결되어야 함
- 장애 주입 테스트: 결함 처리 메커니즘의 효과 검증

#### 7.4.2 안전 분석

- FMEA(고장 모드 및 영향 분석): 가능한 실패 모드 식별 및 영향 평가
- FTA(결함 트리 분석): 안전 목표 위반 원인 분석
- HAZOP(위험 및 운용성 연구): 시스템 운영 중 발생 가능한 위험 식별

#### 7.4.3 독립적 검증

- 안전 중요 컴포넌트는 개발팀과 독립된 팀의 검증 필요
- 안전 평가 보고서 작성 및 승인 프로세스 정의

### 7.5 런타임 모니터링 및 진단

PolicyManager는 다음과 같은 런타임 모니터링 및 진단 기능을 제공합니다:

- 서비스 실행 시간 모니터링: 실행 시간이 임계값을 초과하는 경우 대응
- 리소스 사용량 모니터링: 메모리, CPU 사용량 추적 및 과부하 방지
- 오류 로깅: 안전 관련 오류의 상세 로깅 및 30일간 보관
- 건전성 모니터링: 1초 간격의 건전성 확인

### 7.6 안전 문서화 요구사항

ISO 26262 준수를 위한 다음 문서를 관리합니다:

- 안전 계획: 안전 활동, 일정, 담당자 정의
- 안전 요구사항 명세: 기능 안전 요구사항 상세 정의
- 안전 분석 보고서: FMEA, FTA 등 안전 분석 결과
- 테스트 명세 및 보고서: 안전 검증 테스트 절차 및 결과
- 안전 케이스: 안전 목표 달성 근거 제시
- 안전 평가 보고서: 독립적인 안전 평가 결과

## 8. 결론

이 문서에서 정의한 우선순위 테이블과 결정 로직을 통해 PICCOLO PolicyManager는 차량의 현재 상태, 서비스의 안전 중요성, 리소스 사용, 자율주행 레벨에 따라 최적의 서비스 관리 결정을 내릴 수 있습니다. ISO 26262 기능 안전성 요구사항을 통합함으로써, 자율주행 레벨이 높아질수록 안전 중요 서비스의 우선순위는 계속 유지되면서도, 차량 제어가 자동화됨에 따라 인포테인먼트와 편의 기능의 우선순위가 점진적으로 상승하는 경향을 보입니다. 이를 통해 자율주행 상황에서도 차량의 안전성을 보장하면서 사용자 경험을 최적화할 수 있습니다.
